<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>UriPlant - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-10">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-emerald-500">üõ°Ô∏è Panel Admin</h1>
            <button onclick="localStorage.clear(); window.location.href='/'" class="bg-red-600 px-4 py-2 rounded">Keluar</button>
        </div>

        <div class="bg-gray-800 p-6 rounded-xl mb-8 border border-gray-700">
            <h2 class="text-xl mb-4 text-emerald-400">Tambah Pengguna Baru</h2>
            <div class="flex gap-4">
                <input id="u" type="text" placeholder="Username" class="bg-gray-700 p-2 rounded flex-1">
                <input id="p" type="password" placeholder="Password" class="bg-gray-700 p-2 rounded flex-1">
                <select id="r" class="bg-gray-700 p-2 rounded">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
                <button onclick="addUser()" class="bg-emerald-600 px-6 rounded font-bold">Simpan</button>
            </div>
        </div>

        <table class="w-full bg-gray-800 rounded-xl overflow-hidden">
            <thead class="bg-emerald-900 text-left">
                <tr>
                    <th class="p-4">Username</th>
                    <th class="p-4">Role</th>
                    <th class="p-4">API Key</th>
                    <th class="p-4">Aksi</th>
                </tr>
            </thead>
            <tbody id="userList"></tbody>
        </table>
    </div>

    <script>
        async function loadUsers() {
            const res = await fetch('/api/v1/admin/users');
            const data = await res.json();
            document.getElementById('userList').innerHTML = data.map(u => `
                <tr class="border-t border-gray-700">
                    <td class="p-4">${u.username}</td>
                    <td class="p-4"><span class="bg-gray-700 px-2 rounded">${u.role}</span></td>
                    <td class="p-4 text-yellow-500 font-mono text-sm">${u.apiKey}</td>
                    <td class="p-4"><button onclick="delUser(${u.id})" class="text-red-500">Hapus</button></td>
                </tr>
            `).join('');
        }
        async function addUser() {
            await fetch('/api/v1/admin/users', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: document.getElementById('u').value, password: document.getElementById('p').value, role: document.getElementById('r').value})
            });
            loadUsers();
        }
        async function delUser(id) {
            await fetch(`/api/v1/admin/users/${id}`, { method: 'DELETE' });
            loadUsers();
        }
        loadUsers();
    </script>
</body>
</html>